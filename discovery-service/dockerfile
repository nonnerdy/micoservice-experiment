# Use OpenJDK 21 base image for building the application
FROM maven:3.8.6-openjdk-17 AS build

# Install Maven manually
#RUN apt-get update &&  apt-get install -y maven

# Set working directory
WORKDIR /app


# Copy pom.xml or build.gradle
COPY pom.xml .


# Copy source code
COPY src ./src

# Download dependencies
#RUN mvn dependency:go-offline -B


# Package the application into a JAR file
RUN mvn clean install -DskipTests

# Use a smaller JRE base image for the final image
FROM openjdk:21-jdk-slim

# Set working directory in the container
WORKDIR /app

# Copy the JAR file from the build stage
COPY --from=build /app/target/discovery-service.jar /app/discovery-service.jar

# Expose the port the service runs on
EXPOSE 8761

# Command to run the application when the container starts
ENTRYPOINT ["java", "-jar", "/app/discovery-service.jar"]
